<div class="min-h-screen bg-gray-900 text-white p-4 safe-area-top safe-area-bottom">
  <div class="max-w-2xl mx-auto">
    
    <!-- Header -->
    <div class="mb-6" role="heading" aria-level="1">
      <h1 class="text-2xl font-bold mb-2">Audio & Alert Settings</h1>
      <p class="text-gray-400">Configure sounds and duration thresholds for each brainwave band</p>
    </div>

    <!-- Global controls -->
    <div class="bg-gray-800 rounded-lg p-4 mb-6" role="region" aria-labelledby="global-controls-heading">
      <h2 class="text-lg font-semibold mb-4" id="global-controls-heading">Global Controls</h2>
      
      <!-- Master volume -->
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <label class="text-sm font-medium">Master Volume</label>
          <span class="text-sm text-gray-400">{{ audioService.masterVolume() }}%</span>
        </div>
        <input 
          type="range" 
          min="0" 
          max="100" 
          [value]="audioService.masterVolume()"
          (input)="updateMasterVolume(+$any($event.target).value)"
          class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
          aria-label="Master volume control"
          [attr.aria-valuenow]="audioService.masterVolume()"
          aria-valuemin="0"
          aria-valuemax="100"
          [attr.aria-valuetext]="audioService.masterVolume() + ' percent'">
      </div>

      <!-- Global enable/disable -->
      <div class="flex items-center justify-between">
        <label class="text-sm font-medium">Enable All Sounds</label>
        <button 
          (click)="toggleGlobalEnabled()"
          [class]="audioService.globalEnabled() 
            ? 'bg-green-600 hover:bg-green-700' 
            : 'bg-gray-600 hover:bg-gray-500'"
          class="touch-target px-4 py-2 rounded-lg font-medium transition-colors"
          role="switch"
          [attr.aria-checked]="audioService.globalEnabled()"
          [attr.aria-label]="'Enable all sounds: ' + (audioService.globalEnabled() ? 'Enabled' : 'Disabled')">
          {{ audioService.globalEnabled() ? 'Enabled' : 'Disabled' }}
        </button>
      </div>
    </div>

    <!-- Dominant Frequency Alerts -->
    <div class="bg-gray-800 rounded-lg p-4 mb-6 border-2 border-purple-500/30" role="region" aria-labelledby="dominant-alerts-heading">
      <div class="flex items-center gap-2 mb-3">
        <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
        </svg>
        <h2 class="text-lg font-semibold" id="dominant-alerts-heading">Dominant Frequency Alerts</h2>
      </div>
      <p class="text-sm text-gray-400 mb-4">
        Alert when the primary/dominant band (30-second average) changes. More stable than live alerts.
      </p>

      <!-- Enable toggle -->
      <div class="flex items-center justify-between mb-4">
        <label class="text-sm font-medium">Enable Dominant Alerts</label>
        <button 
          (click)="updateDominantEnabled(!alertService.dominantAlertSettings().enabled)"
          [class]="alertService.dominantAlertSettings().enabled 
            ? 'bg-purple-600 hover:bg-purple-700' 
            : 'bg-gray-600 hover:bg-gray-500'"
          class="touch-target px-4 py-2 rounded-lg font-medium transition-colors"
          role="switch"
          [attr.aria-checked]="alertService.dominantAlertSettings().enabled"
          [attr.aria-label]="'Dominant alerts: ' + (alertService.dominantAlertSettings().enabled ? 'Enabled' : 'Disabled')">
          {{ alertService.dominantAlertSettings().enabled ? 'Enabled' : 'Disabled' }}
        </button>
      </div>

      @if (alertService.dominantAlertSettings().enabled) {
        <div class="space-y-4 pt-4 border-t border-gray-700">
          
          <!-- Confidence Level -->
          <div>
            <label class="text-sm font-medium mb-2 block flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Confidence Level
            </label>
            <select 
              [value]="alertService.dominantAlertSettings().confidenceLevel"
              (change)="updateDominantConfidenceLevel($any($event.target).value)"
              class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm"
              aria-label="Confidence level for dominant alerts"
              id="confidence-level-select">
              <option value="any">1 Star+ (Any)</option>
              <option value="moderate-plus">2 Stars+ (Moderate+)</option>
              <option value="high-plus">3 Stars+ (High+)</option>
              <option value="very-high">4 Stars (Very High)</option>
            </select>
            <p class="text-xs text-gray-500">
              {{ getConfidenceDescription(alertService.dominantAlertSettings().confidenceLevel) }}
            </p>
          </div>

          <!-- Audio Distinction Mode -->
          <div>
            <label class="text-sm font-medium mb-2 block flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
              </svg>
              Audio Distinction
            </label>
            <select 
              [value]="alertService.dominantAlertSettings().audioMode"
              (change)="updateDominantAudioMode($any($event.target).value)"
              class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm"
              aria-label="Audio distinction mode for dominant alerts"
              id="audio-mode-select">
              <option value="same-as-live">Same as Live Alerts</option>
              <option value="pitch-higher">Higher Pitch (Recommended)</option>
              <option value="pitch-lower">Lower Pitch</option>
              <option value="separate" disabled>Separate Audio (Coming Soon)</option>
            </select>
            <p class="text-xs text-gray-500">
              {{ getAudioModeDescription(alertService.dominantAlertSettings().audioMode) }}
            </p>
          </div>

          <!-- Pitch Adjustment (only show if pitch mode selected) -->
          @if (alertService.dominantAlertSettings().audioMode === 'pitch-higher' || 
                alertService.dominantAlertSettings().audioMode === 'pitch-lower') {
            <div>
              <div class="flex items-center justify-between mb-2">
                <label class="text-sm font-medium">Pitch Shift</label>
                <span class="text-sm text-gray-400">{{ alertService.dominantAlertSettings().pitchShift }}%</span>
              </div>
              <input 
                type="range" 
                min="50" 
                max="200" 
                step="5"
                [value]="alertService.dominantAlertSettings().pitchShift"
                (input)="updateDominantPitchShift(+$any($event.target).value)"
                class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
                aria-label="Pitch shift percentage"
                [attr.aria-valuenow]="alertService.dominantAlertSettings().pitchShift"
                aria-valuemin="50"
                aria-valuemax="200"
                [attr.aria-valuetext]="alertService.dominantAlertSettings().pitchShift + ' percent'"
                id="pitch-shift-slider">
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>Lower (50%)</span>
                <span>Normal (100%)</span>
                <span>Higher (200%)</span>
              </div>
            </div>
          }

          <!-- Cooldown -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm font-medium flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Cooldown Period
              </label>
              <span class="text-sm text-gray-400">{{ alertService.dominantAlertSettings().cooldownSeconds.toFixed(1) }}s</span>
            </div>
            <input 
              type="range" 
              min="0" 
              max="60" 
              step="1"
              [value]="alertService.dominantAlertSettings().cooldownSeconds"
              (input)="updateDominantCooldown(+$any($event.target).value)"
              class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
              aria-label="Cooldown period in seconds"
              [attr.aria-valuenow]="alertService.dominantAlertSettings().cooldownSeconds"
              aria-valuemin="0"
              aria-valuemax="60"
              [attr.aria-valuetext]="alertService.dominantAlertSettings().cooldownSeconds + ' seconds'"
              id="cooldown-slider">
            <p class="text-xs text-gray-500 mt-1">
              Minimum time between alerts to prevent rapid re-triggering
            </p>
          </div>

          <!-- Test Sound Button -->
          <div>
            <button
              (click)="testDominantSound()"
              class="w-full touch-target px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-colors flex items-center justify-center gap-2"
              aria-label="Test dominant frequency alert sound with current settings">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
              </svg>
              Test Sound
            </button>
            <p class="text-xs text-gray-500 mt-2">
              Preview how the dominant frequency alert will sound with your current audio distinction and pitch shift settings
            </p>
          </div>

          <!-- Info box -->
          <div class="bg-purple-900/20 border border-purple-700/50 rounded-lg p-3 mt-4">
            <div class="flex gap-2">
              <svg class="w-5 h-5 text-purple-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div class="text-xs text-gray-300">
                <p class="font-medium mb-1">How it works:</p>
                <ul class="space-y-1 text-gray-400">
                  <li>• Monitors 30-second rolling average of brain activity</li>
                  <li>• Triggers when dominant band changes and meets confidence level</li>
                  <li>• More stable than live alerts, reduces false positives</li>
                  <li>• Audio can be distinguished from live alerts (pitch shift recommended)</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Band settings -->
    <div class="space-y-3">
      @for (band of bands; track band) {
        <div 
          class="bg-gray-800 rounded-lg overflow-hidden border-2 transition-colors"
          [style.border-color]="getBandInfo(band).color + '40'">
          
          <!-- Band header (always visible) -->
          <button
            (click)="toggleBandExpansion(band)"
            class="w-full p-4 flex items-center justify-between hover:bg-gray-750 transition-colors touch-target">
            <div class="flex items-center gap-3">
              <div 
                class="w-6 h-6 rounded"
                [style.background-color]="getBandInfo(band).color">
              </div>
              <div class="text-left">
                <div class="font-semibold">{{ getBandInfo(band).label }}</div>
                <div class="text-sm text-gray-400">{{ getBandInfo(band).range }}</div>
              </div>
            </div>
            
            <svg 
              class="w-6 h-6 transition-transform"
              [class.rotate-180]="isBandExpanded(band)"
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Expanded settings -->
          @if (isBandExpanded(band)) {
            <div class="p-4 border-t border-gray-700 space-y-4">
              
              <!-- Duration threshold -->
              <div class="bg-gray-900/50 rounded-lg p-3">
                <h3 class="text-sm font-semibold mb-3 flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Duration Threshold
                </h3>
                
                <div class="mb-3">
                  <div class="flex items-center justify-between mb-2">
                    <label class="text-sm text-gray-400">Minimum Duration (seconds)</label>
                    <span class="text-sm font-medium">{{ getThreshold(band).duration.toFixed(1) }}s</span>
                  </div>
                  <input 
                    type="range" 
                    min="0" 
                    max="30" 
                    step="0.5"
                    [value]="getThreshold(band).duration"
                    (input)="updateThresholdDuration(band, +$any($event.target).value)"
                    class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
                    [attr.aria-label]="'Duration threshold for ' + getBandInfo(band).label + ' band'"
                    [attr.aria-valuenow]="getThreshold(band).duration"
                    aria-valuemin="0"
                    aria-valuemax="30"
                    [attr.aria-valuetext]="getThreshold(band).duration + ' seconds'"
                    [attr.id]="band + '-duration-slider'">
                  <p class="text-xs text-gray-500 mt-1">
                    Alert triggers after staying in this band for the set duration
                  </p>
                </div>

                <label class="flex items-center gap-2 cursor-pointer">
                  <input 
                    type="checkbox" 
                    [checked]="getThreshold(band).enabled"
                    (change)="updateThresholdEnabled(band, $any($event.target).checked)"
                    class="w-4 h-4 rounded"
                    [attr.aria-label]="'Enable alerts for ' + getBandInfo(band).label + ' band'"
                    [attr.id]="band + '-threshold-checkbox'">
                  <span class="text-sm">Enable threshold alerts for this band</span>
                </label>
              </div>

              <!-- Audio source type -->
              <div>
                <label class="text-sm font-medium mb-2 block">Audio Source</label>
                <div class="grid grid-cols-2 gap-2">
                  <button
                    (click)="updateSourceType(band, 'preset')"
                    [class]="getBandConfig(band).sourceType === 'preset' 
                      ? 'bg-blue-600 border-blue-500' 
                      : 'bg-gray-700 border-gray-600'"
                    class="touch-target px-3 py-2 rounded border-2 text-sm font-medium transition-colors"
                    [attr.aria-label]="'Use preset sound for ' + getBandInfo(band).label + ' band'"
                    [attr.aria-pressed]="getBandConfig(band).sourceType === 'preset'">
                    Preset
                  </button>
                  <button
                    (click)="updateSourceType(band, 'tone')"
                    [class]="getBandConfig(band).sourceType === 'tone' 
                      ? 'bg-blue-600 border-blue-500' 
                      : 'bg-gray-700 border-gray-600'"
                    class="touch-target px-3 py-2 rounded border-2 text-sm font-medium transition-colors"
                    [attr.aria-label]="'Generate tone for ' + getBandInfo(band).label + ' band'"
                    [attr.aria-pressed]="getBandConfig(band).sourceType === 'tone'">
                    Tone
                  </button>
                  <button
                    (click)="updateSourceType(band, 'custom')"
                    [class]="getBandConfig(band).sourceType === 'custom' 
                      ? 'bg-blue-600 border-blue-500' 
                      : 'bg-gray-700 border-gray-600'"
                    class="touch-target px-3 py-2 rounded border-2 text-sm font-medium transition-colors"
                    [attr.aria-label]="'Upload custom sound for ' + getBandInfo(band).label + ' band'"
                    [attr.aria-pressed]="getBandConfig(band).sourceType === 'custom'">
                    Custom
                  </button>
                  <button
                    (click)="updateSourceType(band, 'disabled')"
                    [class]="getBandConfig(band).sourceType === 'disabled' 
                      ? 'bg-blue-600 border-blue-500' 
                      : 'bg-gray-700 border-gray-600'"
                    class="touch-target px-3 py-2 rounded border-2 text-sm font-medium transition-colors"
                    [attr.aria-label]="'Disable alerts for ' + getBandInfo(band).label + ' band'"
                    [attr.aria-pressed]="getBandConfig(band).sourceType === 'disabled'">
                    Disabled
                  </button>
                </div>
              </div>

              <!-- Preset sound selection -->
              @if (getBandConfig(band).sourceType === 'preset') {
                <div>
                  <label class="text-sm font-medium mb-2 block">Preset Sound</label>
                  <select 
                    [value]="getBandConfig(band).presetSound || band"
                    (change)="updatePresetSound(band, $any($event.target).value)"
                    class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                    [attr.aria-label]="'Select preset sound for ' + getBandInfo(band).label + ' band'"
                    [attr.id]="band + '-preset-select'">
                    @for (sound of presetSounds; track sound) {
                      <option [value]="sound" [selected]="getBandConfig(band).presetSound === sound">
                        {{ sound.charAt(0).toUpperCase() + sound.slice(1) }}
                      </option>
                    }
                  </select>
                </div>
              }

              <!-- Tone configuration -->
              @if (getBandConfig(band).sourceType === 'tone') {
                <div class="space-y-3">
                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <label class="text-sm font-medium">Frequency (Hz)</label>
                      <span class="text-sm text-gray-400">{{ getBandConfig(band).toneFrequency }}</span>
                    </div>
                    <input 
                      type="range" 
                      min="100" 
                      max="2000" 
                      step="10"
                      [value]="getBandConfig(band).toneFrequency"
                      (input)="updateToneFrequency(band, +$any($event.target).value)"
                      class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
                      [attr.aria-label]="'Tone frequency for ' + getBandInfo(band).label + ' band'"
                      [attr.aria-valuenow]="getBandConfig(band).toneFrequency"
                      aria-valuemin="100"
                      aria-valuemax="2000"
                      [attr.aria-valuetext]="getBandConfig(band).toneFrequency + ' hertz'"
                      [attr.id]="band + '-frequency-slider'">
                  </div>

                  <div>
                    <label class="text-sm font-medium mb-2 block">Wave Type</label>
                    <select 
                      [value]="getBandConfig(band).toneType"
                      (change)="updateToneType(band, $any($event.target).value)"
                      class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                      [attr.aria-label]="'Wave type for ' + getBandInfo(band).label + ' band'"
                      [attr.id]="band + '-wavetype-select'">
                      @for (type of oscillatorTypes; track type) {
                        <option [value]="type">{{ type }}</option>
                      }
                    </select>
                  </div>

                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <label class="text-sm font-medium">Duration (ms)</label>
                      <span class="text-sm text-gray-400">{{ getBandConfig(band).toneDuration }}</span>
                    </div>
                    <input 
                      type="range" 
                      min="50" 
                      max="2000" 
                      step="50"
                      [value]="getBandConfig(band).toneDuration"
                      (input)="updateToneDuration(band, +$any($event.target).value)"
                      class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
                      [attr.aria-label]="'Tone duration for ' + getBandInfo(band).label + ' band'"
                      [attr.aria-valuenow]="getBandConfig(band).toneDuration"
                      aria-valuemin="50"
                      aria-valuemax="2000"
                      [attr.aria-valuetext]="getBandConfig(band).toneDuration + ' milliseconds'"
                      [attr.id]="band + '-duration-slider'">
                  </div>
                </div>
              }

              <!-- Custom audio upload -->
              @if (getBandConfig(band).sourceType === 'custom') {
                <div>
                  @if (getBandConfig(band).customAudioUrl) {
                    <div class="bg-gray-900/50 rounded p-3 mb-2">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                          <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                          </svg>
                          <span class="text-sm">{{ getBandConfig(band).customAudioName }}</span>
                        </div>
                        <button
                          (click)="clearCustomAudio(band)"
                          class="text-red-500 hover:text-red-400 p-1">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  }
                  
                  <label class="block">
                    <input 
                      type="file" 
                      accept="audio/*"
                      (change)="onFileSelected(band, $event)"
                      class="hidden"
                      [attr.aria-label]="'Upload audio file for ' + getBandInfo(band).label + ' band'"
                      [attr.id]="band + '-file-input'">
                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-4 text-center cursor-pointer hover:border-gray-500 transition-colors">
                      <svg class="w-8 h-8 mx-auto mb-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                      </svg>
                      <p class="text-sm text-gray-400">Click to upload audio file</p>
                      <p class="text-xs text-gray-500 mt-1">MP3, WAV, OGG (max 5MB)</p>
                    </div>
                  </label>
                </div>
              }

              <!-- Volume control -->
              <div>
                <div class="flex items-center justify-between mb-2">
                  <label class="text-sm font-medium">Volume</label>
                  <span class="text-sm text-gray-400">{{ getBandConfig(band).volume }}%</span>
                </div>
                <input 
                  type="range" 
                  min="0" 
                  max="100" 
                  [value]="getBandConfig(band).volume"
                  (input)="updateVolume(band, +$any($event.target).value)"
                  class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
                  [attr.aria-label]="'Volume level for ' + getBandInfo(band).label + ' band'"
                  [attr.aria-valuenow]="getBandConfig(band).volume"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  [attr.aria-valuetext]="getBandConfig(band).volume + ' percent'"
                  [attr.id]="band + '-volume-slider'">
              </div>

              <!-- Test button -->
              <div class="flex gap-2">
                <button
                  (click)="testSound(band)"
                  class="touch-target flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-colors"
                  [attr.aria-label]="'Test sound for ' + getBandInfo(band).label + ' band'">
                  Test Sound
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Data Management Section -->
    <div class="mt-6 bg-gray-800 rounded-lg p-4">
      <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
        </svg>
        Data Management
      </h2>
      <p class="text-sm text-gray-400 mb-4">
        Backup and restore your settings, thresholds, and session history
      </p>

      <!-- Status message -->
      @if (importMessage()) {
        <div 
          class="mb-4 p-3 rounded-lg text-sm font-medium"
          [class.bg-green-900/30]="importSuccess()"
          [class.border-green-700]="importSuccess()"
          [class.text-green-400]="importSuccess()"
          [class.bg-red-900/30]="!importSuccess()"
          [class.border-red-700]="!importSuccess()"
          [class.text-red-400]="!importSuccess()"
          [class.border]="true">
          {{ importMessage() }}
        </div>
      }

      <!-- Export -->
      <div class="mb-4">
        <h3 class="text-sm font-medium mb-2 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Export Data
        </h3>
        <p class="text-xs text-gray-400 mb-3">
          Download a backup file containing all your settings and sessions
        </p>
        <button
          (click)="exportData()"
          class="w-full touch-target px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors"
          aria-label="Download backup of all settings and sessions">
          Download Backup
        </button>
      </div>

      <!-- Import -->
      <div class="mb-4">
        <h3 class="text-sm font-medium mb-2 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
          </svg>
          Import Data
        </h3>
        <p class="text-xs text-gray-400 mb-3">
          Restore from a previous backup file (replaces current data)
        </p>
        <label class="block w-full touch-target px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-colors text-center cursor-pointer"
               for="import-backup-input">
          Import Backup
          <input 
            type="file" 
            accept=".json"
            (change)="importData($event)"
            class="hidden"
            aria-label="Select backup JSON file to import"
            id="import-backup-input">
        </label>
      </div>

      <!-- Info -->
      <div class="bg-gray-900/50 rounded-lg p-3 space-y-2 text-xs">
        <div class="flex items-center justify-between">
          <span class="text-gray-400">Storage Used:</span>
          <span class="font-medium">{{ getStorageInfo() }}</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-400">Last Backup:</span>
          <span class="font-medium">{{ getLastBackupDate() }}</span>
        </div>
        <div class="pt-2 border-t border-gray-700">
          <p class="text-gray-500 text-xs">
            💡 Tip: Export regularly to protect your data. Backups can be imported on any device or browser.
          </p>
        </div>
      </div>
    </div>

    <!-- Reset button -->
    <div class="mt-6">
      <button
        (click)="resetAllSettings()"
        class="touch-target w-full px-4 py-3 bg-red-900/30 hover:bg-red-900/50 border border-red-700 rounded-lg font-medium transition-colors"
        aria-label="Reset all settings to default values">
        Reset All Settings to Defaults
      </button>
    </div>

    <!-- Footer: Version & Disclaimer -->
    <div class="mt-8 pt-6 border-t border-gray-700 space-y-3">
      <div class="text-center text-xs text-gray-500">
        <p class="font-medium">OpenBCI Brainwave Monitor v{{ version }}</p>
      </div>
      
      <div class="text-center text-xs text-gray-500">
        <button 
          (click)="showDisclaimer = !showDisclaimer"
          class="cursor-pointer hover:text-gray-400 transition-colors inline-flex items-center gap-1"
          aria-expanded="{{showDisclaimer}}"
          aria-label="Toggle medical disclaimer">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Medical Disclaimer
          <svg class="w-3 h-3 transition-transform" [class.rotate-180]="showDisclaimer" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        
        @if (showDisclaimer) {
          <div class="mt-3 p-3 bg-gray-800/50 rounded text-left border border-yellow-600/30">
            <p class="mb-2">⚠️ <strong>For Research & Educational Use Only</strong></p>
            <p class="text-gray-400 leading-relaxed">
              This software is not a medical device and has not been evaluated by the FDA. 
              It is not intended to diagnose, treat, cure, or prevent any disease or medical condition. 
              Consult qualified healthcare professionals for medical advice. Use at your own risk.
            </p>
            <p class="mt-2 text-gray-500">
              Licensed under MIT License. See LICENSE file for details.
            </p>
          </div>
        }
      </div>
    </div>
  </div>
</div>
